# MDxEditor: ä¸‹ä¸€ä»£å¯æ‰©å±• Markdown ç¼–è¾‘ä¸æ¸²æŸ“å¼•æ“

**MDxEditor** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ JavaScript åº“ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´ã€ç°ä»£åŒ–çš„ Markdown ç¼–è¾‘å’Œæ¸²æŸ“è§£å†³æ–¹æ¡ˆã€‚å®ƒå¹¶éåˆä¸€ä¸ªç®€å•çš„è§£æå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªä»¥**æ’ä»¶ä¸ºä¸­å¿ƒ**ã€**æœåŠ¡é©±åŠ¨**ã€é«˜åº¦å¯æ‰©å±•çš„å†…å®¹å¤„ç†å¹³å°ï¼Œä¸“ä¸ºéœ€è¦æ·±åº¦å®šåˆ¶å’Œä¸°å¯Œäº¤äº’çš„å¤æ‚åº”ç”¨åœºæ™¯è€Œè®¾è®¡ã€‚

æˆ‘ä»¬çš„æ ¸å¿ƒè®¾è®¡å“²å­¦æ˜¯ï¼š**å†…æ ¸åªåšç¼–æ’ï¼ŒåŠŸèƒ½çš†ç”±æ’ä»¶è´¡çŒ®**ã€‚

è¿™ç§æ¶æ„èµ‹äºˆäº†æ‚¨æ— ä¸ä¼¦æ¯”çš„çµæ´»æ€§ã€‚æ— è®ºæ‚¨æ˜¯æƒ³æ„å»ºï¼š
*   ä¸€ä¸ªç±»ä¼¼ Anki çš„**è®°å¿†å¡ç‰‡åº”ç”¨**ï¼ˆéœ€è¦ Cloze å¡«ç©ºå’Œè‡ªå®šä¹‰äº¤äº’ï¼‰
*   ä¸€ä¸ªç±»ä¼¼ Obsidian çš„**åŒå‘é“¾æ¥çŸ¥è¯†åº“**ï¼ˆéœ€è¦å¼ºå¤§çš„æåŠå’ŒåµŒå…¥ç³»ç»Ÿï¼‰
*   ä¸€ä¸ª**äº¤äº’å¼æ–‡æ¡£æˆ–æ•™ç¨‹ç³»ç»Ÿ**
*   ä¸€ä¸ª AI Agent çš„**æµå¼å“åº”æ¸²æŸ“ç•Œé¢**
*   ä¸€ä¸ª**åç«¯çš„æ–‡æ¡£è½¬æ¢æœåŠ¡** (ä¾‹å¦‚ï¼Œå°†åŒ…å«ç‰¹æ®ŠæŒ‡ä»¤çš„ Markdown è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼)

MDxEditor éƒ½èƒ½ä¸ºæ‚¨æä¾›åšå¦‚ç£çŸ³çš„åŸºç¡€ã€‚

![MDxEditor åŠ¨ç”»æ¼”ç¤º](https://user-images.githubusercontent.com/12345/placeholder.gif)  
*(è¯·æ›¿æ¢ä¸ºå±•ç¤º @mentionã€Cloze äº¤äº’ã€åŒå‘è·³è½¬å’Œå·¥å…·æ çš„ GIF åŠ¨ç”»)*

## âœ¨ æ ¸å¿ƒç‰¹æ€§

*   **ç¼–è¾‘ä¸é¢„è§ˆæ— ç¼åˆ‡æ¢**: æä¾›ä¸€ä¸ªé›†æˆçš„è§†å›¾ï¼Œç”¨æˆ·å¯ä»¥åœ¨æºç ç¼–è¾‘å’Œå®æ—¶é¢„è§ˆä¹‹é—´æµç•…åˆ‡æ¢ï¼Œå¹¶æ”¯æŒ**åƒç´ çº§åŒæ­¥æ»šåŠ¨**ã€‚
*   **ç»Ÿä¸€çš„ç¨‹åºåŒ–æœç´¢ API**: æ— è®ºæ˜¯åœ¨ç¼–è¾‘æ¨¡å¼è¿˜æ˜¯é¢„è§ˆæ¨¡å¼ï¼Œéƒ½æä¾›äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„ API (`search`, `gotoMatch`, `clearSearch`)ï¼Œå…è®¸å¤–éƒ¨ UI ç»„ä»¶è½»æ¾å®ç°å¯¹å†…å®¹çš„æŸ¥æ‰¾ã€é«˜äº®å’Œå®šä½åŠŸèƒ½ã€‚
*   **æºç -é¢„è§ˆåŒå‘é“¾æ¥**: åœ¨é¢„è§ˆæ¨¡å¼ä¸‹ï¼ŒæŒ‰ä½ `Ctrl/Cmd` å¹¶åŒå‡»ä»»æ„å…ƒç´ ï¼ˆå¦‚æ®µè½ã€å¡«ç©ºï¼‰ï¼Œå³å¯**ç²¾å‡†è·³è½¬**åˆ°å…¶å¯¹åº”çš„æºç ä½ç½®ï¼Œæå¤§æå‡äº†å†…å®¹ç»´æŠ¤æ•ˆç‡ã€‚
*   **é«˜åº¦å¯é…ç½®çš„ UI**: é™¤äº†å¼ºå¤§çš„å·¥å…·æ ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå¯å®šåˆ¶çš„**æ ‡é¢˜æ **ï¼Œå¯ä»¥è½»æ¾æ·»åŠ è‡ªå®šä¹‰æ“ä½œæŒ‰é’®ï¼Œå¦‚ AI å¤„ç†ã€ä¿å­˜ã€æ‰“å°ç­‰ï¼Œå¹¶å°†å®ƒä»¬ä¸æ‚¨çš„åº”ç”¨é€»è¾‘æ·±åº¦é›†æˆã€‚
*   **æ’ä»¶åŒ–æ¶æ„ (Plugin-Driven Architecture)**: æ ¸å¿ƒåº“è½»é‡ç¨³å®šï¼Œæ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼ˆåŒ…æ‹¬æåŠã€å›¾è¡¨ã€å…¬å¼ç­‰ï¼‰å‡ç”±**ç‹¬ç«‹çš„æ’ä»¶**æä¾›ã€‚æ‚¨å¯ä»¥æŒ‰éœ€ç»„åˆï¼Œç”šè‡³ç¼–å†™è‡ªå·±çš„æ’ä»¶æ¥æ‰©å±•æ— é™å¯èƒ½ã€‚
*   **ä¸–ç•Œçº§çš„æåŠä¸å†…å®¹é“¾æ¥ç³»ç»Ÿ (`@mention`)**:
    *   **æ™ºèƒ½å»ºè®®**: è¾“å…¥ `@` (æˆ–å…¶ä»–å¯é…ç½®çš„è§¦å‘ç¬¦) å³å¯ä»ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æºè·å¾—ä¸Šä¸‹æ–‡ç›¸å…³çš„å»ºè®®åˆ—è¡¨ã€‚
    *   **æ‚¬æµ®é¢„è§ˆ**: å°†é¼ æ ‡æ‚¬åœåœ¨æåŠé“¾æ¥ä¸Šï¼Œå³å¯æŸ¥çœ‹ç”±æ•°æ®æºæä¾›çš„ä¸°å¯Œå†…å®¹é¢„è§ˆå¡ç‰‡ã€‚
    *   **å†…å®¹åµŒå…¥ (Transclusion)**: ä½¿ç”¨ `!@type:id` è¯­æ³•å°†å…¶ä»–æ–‡æ¡£æˆ–å†…å®¹å—ç›´æ¥åµŒå…¥åˆ°å½“å‰æ–‡æ¡£ä¸­ã€‚
    *   **å¼•ç”¨è‡ªåŠ¨æ›´æ–°**: å½“è¢«å¼•ç”¨çš„é¡¹ç›®ï¼ˆå¦‚æ–‡ä»¶åï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç¼–è¾‘å™¨å†…çš„æ‰€æœ‰ç›¸å…³æåŠé“¾æ¥éƒ½ä¼š**è‡ªåŠ¨æ›´æ–°**å…¶æ˜¾ç¤ºæ–‡æœ¬ï¼Œè§£å†³äº†é“¾æ¥å¤±æ•ˆçš„ç—›ç‚¹ã€‚
    *   **å®Œå…¨å¯æ‰©å±•**: é€šè¿‡å®ç°ä¸€ä¸ªç®€å•çš„ `Provider` æ¥å£ï¼Œæ‚¨å¯ä»¥è½»æ¾æ·»åŠ å¯¹ä»»ä½•å†…å®¹æºçš„æ”¯æŒï¼Œä¾‹å¦‚ `@user`ã€`#jira-ticket`ã€`!file` æˆ–æ‚¨è‡ªå·±çš„ä¸šåŠ¡å¯¹è±¡ã€‚
*   **ä¸¤ç§æ¸²æŸ“æ¨¡å¼**:
    *   **é™æ€å—æ¸²æŸ“ (Static Rendering)**: ä¸€æ¬¡æ€§å°†å®Œæ•´çš„ Markdown æ–‡æœ¬æ¸²æŸ“æˆ HTMLï¼Œé€‚ç”¨äºæ–‡ç« ã€æ–‡æ¡£ç­‰åœºæ™¯ã€‚
    *   **æµå¼æ¸²æŸ“ (Streaming Rendering)**: åŠ¨æ€åœ°å°†æ–‡æœ¬å—è¿½åŠ åˆ°è§†å›¾ä¸­å¹¶å®æ—¶æ¸²æŸ“ï¼Œå®Œç¾é€‚é… AI å¯¹è¯ã€æ—¥å¿—æµç­‰éœ€è¦å¢é‡æ›´æ–°çš„åœºæ™¯ã€‚
*   **`MDxProcessor`: å¼ºå¤§çš„æ— å¤´å¤„ç†å¼•æ“**:
    *   **ä¸UIå®Œå…¨è§£è€¦**: åœ¨ Node.js æˆ–ä»»ä½•éæµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ MDxEditor çš„æ ¸å¿ƒè§£æä¸è½¬æ¢èƒ½åŠ›ã€‚
    *   **å£°æ˜å¼è½¬æ¢è§„åˆ™**: é€šè¿‡ç®€å•çš„é…ç½®å¯¹è±¡ï¼Œç²¾ç¡®æ§åˆ¶æ¯ç§ `@mention` åœ¨å¤„ç†åçš„è¡Œä¸ºâ€”â€”æ˜¯**æ›¿æ¢**ä¸ºç‰¹å®šå†…å®¹ã€ä»æ–‡æœ¬ä¸­**ç§»é™¤**ï¼Œè¿˜æ˜¯ä¿æŒ**åŸæ ·**ã€‚
    *   **å…ƒæ•°æ®æå–**: åœ¨è½¬æ¢æ–‡æœ¬çš„åŒæ—¶ï¼Œè‡ªåŠ¨æå–æ‰€æœ‰æåŠï¼ˆmentionï¼‰çš„ç»“æ„åŒ–ä¿¡æ¯ï¼Œç”¨äºåç»­åˆ†ææˆ–APIè°ƒç”¨ã€‚
*   **ä¸°å¯Œçš„è¯­æ³•æ”¯æŒ (ç”±å†…ç½®æ’ä»¶æä¾›)**:
    *   **Cloze (å®Œå½¢å¡«ç©º)**: ` --å†…å®¹--` åˆ›å»ºäº¤äº’å¼å¡«ç©ºï¼Œå¹¶å¯é€šè¿‡ `^^audio:text^^` æ·»åŠ è¯­éŸ³æç¤ºã€‚
    *   **GFM ä»»åŠ¡åˆ—è¡¨**: `- [ ]` å’Œ `- [x]` åˆ›å»ºå¯äº¤äº’çš„ä»»åŠ¡æ¸…å•ã€‚
    *   **å›¾è¡¨ä¸å…¬å¼**: å†…ç½®æ”¯æŒ **Mermaid** å›¾è¡¨å’Œ **MathJax** å…¬å¼ã€‚
    *   **å¯æŠ˜å å†…å®¹å—**: `::>` è¯­æ³•åˆ›å»ºå¯ä»¥å±•å¼€å’Œæ”¶èµ·çš„å†…å®¹åŒºåŸŸã€‚
    *   **åª’ä½“åµŒå…¥**: `!video[...]` å’Œ `!file[...]` è½»æ¾åµŒå…¥è§†é¢‘å’Œæ–‡ä»¶é™„ä»¶ã€‚

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### 1. ç¯å¢ƒå‡†å¤‡

é€šè¿‡ npm/yarn å®‰è£… MDxEditorã€‚
```bash
npm install mdx-editor-lib # å‡è®¾åŒ…åä¸º mdx-editor-lib
```

åœ¨æ‚¨çš„ HTML é¡µé¢ä¸­ï¼Œç¡®ä¿å·²å¼•å…¥æ ¸å¿ƒä¾èµ–ã€‚MDxEditor é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸æ†ç»‘è¿™äº›å¤§å‹åº“ï¼Œè®©æ‚¨å¯ä»¥è‡ªç”±é€‰æ‹©ç‰ˆæœ¬æˆ–åŠ è½½æ–¹å¼ã€‚
```html
<!-- æ ¸å¿ƒä¾èµ– -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- å¯é€‰ä¾èµ– (æ ¹æ®æ‚¨å¯ç”¨çš„æ’ä»¶é€‰æ‹©) -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- Font Awesome (ç”¨äºæ ‡é¢˜æ å’Œå·¥å…·æ å›¾æ ‡) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


<!-- æ‚¨çš„åº”ç”¨å…¥å£ï¼Œå°†ä»è¿™é‡Œå¯¼å…¥ MDxEditor -->
<script type="module" src="./app.js"></script>
```

### 2. åŸºæœ¬ç”¨æ³•ï¼šé™æ€æ¸²æŸ“

åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ï¼Œå°† Markdown æ–‡æœ¬æ¸²æŸ“åˆ°é¡µé¢å…ƒç´ ä¸­ã€‚

```html
<div id="output"></div>
```

```javascript
// app.js
import { MDxRenderer, defaultPlugins } from 'mdx-editor-lib';

// 1. åˆ›å»ºæ¸²æŸ“å™¨å®ä¾‹ï¼Œå¹¶åŠ è½½é»˜è®¤æ’ä»¶åŒ…
const renderer = new MDxRenderer(defaultPlugins);

// 2. è·å–ç›®æ ‡å…ƒç´ å’Œ Markdown æ–‡æœ¬
const outputElement = document.getElementById('output');
const markdown = `# æ ‡é¢˜\n\nè¿™æ˜¯ä¸€ä¸ª --cloze-- å¡«ç©ºï¼Œå’Œä¸€ä¸ª Mermaid å›¾è¡¨ï¼š\n\n\`\`\`mermaid\ngraph TD;\n    A-->B;\n\`\`\``;

// 3. æ‰§è¡Œæ¸²æŸ“
renderer.render(outputElement, markdown);
```

### 3. é«˜çº§ç”¨æ³•ï¼šé›†æˆç¼–è¾‘å™¨

åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ç¼–è¾‘å™¨ï¼ŒåŒ…å«å·¥å…·æ ã€**å¯é…ç½®çš„æ ‡é¢˜æ **ã€ç¼–è¾‘/é¢„è§ˆåˆ‡æ¢å’Œæ‰€æœ‰é»˜è®¤åŠŸèƒ½ã€‚

```html
<div id="editor-container" style="height: 600px;"></div>
```

```javascript
// app.js
import { MDxEditor, defaultPlugins } from 'mdx-editor-lib';

const container = document.getElementById('editor-container');
const initialText = `# æ¬¢è¿ä½¿ç”¨ MDxEditor!\n\né€‰æ‹©æ–‡æœ¬ï¼Œç„¶åç‚¹å‡»æ ‡é¢˜æ ä¸Šçš„ âœ¨ AI æŒ‰é’®ã€‚\næˆ–è€…ç›´æ¥ç‚¹å‡» ğŸ’¾ ä¿å­˜æŒ‰é’®ã€‚`;

// åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹
const editor = new MDxEditor(container, {
    initialText: initialText,
    plugins: defaultPlugins, // åŠ è½½åŒ…å«æ‰€æœ‰åŠŸèƒ½çš„æ’ä»¶åŒ…
    
    // [æ–°åŠŸèƒ½] é…ç½®æ ‡é¢˜æ 
    titleBar: {
        title: 'My Document.md', // è®¾ç½®æ–‡æ¡£æ ‡é¢˜

        // æä¾› AI å›è°ƒå‡½æ•°åï¼ŒAI æŒ‰é’®ä¼šè‡ªåŠ¨æ˜¾ç¤º
        aiCallback: (text) => {
            alert(`AI æ­£åœ¨å¤„ç†ä»¥ä¸‹æ–‡æœ¬ (å¦‚æœæ˜¯é€‰ä¸­æ–‡æœ¬ï¼Œåˆ™åªå¤„ç†é€‰ä¸­çš„éƒ¨åˆ†):\n\n---\n${text}\n---`);
            // åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥è°ƒç”¨æ‚¨çš„å®é™… AI æœåŠ¡
        },

        // æä¾›ä¿å­˜å›è°ƒå‡½æ•°åï¼Œä¿å­˜æŒ‰é’®ä¼šè‡ªåŠ¨æ˜¾ç¤º
        saveCallback: (text) => {
            console.log('æ­£åœ¨ä¿å­˜å†…å®¹:', text);
            alert('å†…å®¹å·²ä¿å­˜åˆ°æ§åˆ¶å°ï¼');
            // åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å°†æ–‡æœ¬å‘é€åˆ°åç«¯æˆ–æœ¬åœ°å­˜å‚¨
        }
    }
});
```

## ğŸ› ï¸ **æ ¸å¿ƒåŠŸèƒ½ï¼šæ— å¤´å¤„ç†ä¸å†…å®¹è½¬æ¢ (`MDxProcessor`)**

è¿™æ˜¯ MDxEditor æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒå…è®¸æ‚¨åœ¨åç«¯æˆ–ä»»ä½•éUIç¯å¢ƒä¸­ä½¿ç”¨å…¶æ ¸å¿ƒè§£æèƒ½åŠ›ã€‚

### åœºæ™¯

å‡è®¾æ‚¨æœ‰ä¸€æ®µåŒ…å«ç‰¹æ®ŠæŒ‡ä»¤çš„ Markdownï¼Œæ‚¨å¸Œæœ›ï¼š
1.  æå–å‡º `@app` æŒ‡ä»¤ä½œä¸ºå…ƒæ•°æ®ã€‚
2.  å°† `@file` æŒ‡ä»¤æ›¿æ¢ä¸ºå…¶çœŸå®çš„æ–‡ä»¶å†…å®¹ã€‚

**åŸå§‹ Markdown (`input.md`):**
```markdown
@app:parserai
here is the demo file:
@file:file1
```

**æœŸæœ›çš„è¾“å‡º:**
- **è½¬æ¢åçš„æ–‡æœ¬:** `here is the demo file:\n---\n[filename: file1]\n---\nhello world\n---`
- **æå–çš„å…ƒæ•°æ®:** `{ app: ['parserai'], file: ['file1'] }`

### å®ç°

```javascript
// processor-example.js (å¯ä»¥åœ¨ Node.js ä¸­è¿è¡Œ)
import { MDxProcessor, IMentionProvider } from 'mdx-editor-lib';

// 1. [å®šä¹‰æ•°æ®æº] åˆ›å»º Providerï¼Œå®ƒä»¬åªè´Ÿè´£æä¾›åŸå§‹æ•°æ®ã€‚
class AppProvider extends IMentionProvider {
    key = 'app';
    // åœ¨æ— å¤´æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬åªå…³å¿ƒæ•°æ®ï¼Œæ‰€ä»¥åªå®ç° getDataForProcess
    async getDataForProcess(targetURL) {
        // targetURL.pathname is '/parserai'
        return { id: targetURL.pathname.substring(1) };
    }
}

class FileProvider extends IMentionProvider {
    key = 'file';
    async getDataForProcess(targetURL) {
        const fileId = targetURL.pathname.substring(1); // '/file1' -> 'file1'
        // æ¨¡æ‹Ÿæ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»ŸæŸ¥æ‰¾
        const fileDatabase = {
            'file1': 'hello world'
        };
        const content = fileDatabase[fileId];
        return content ? { id: fileId, name: fileId, content } : null;
    }
}

// 2. [åˆå§‹åŒ–] åˆ›å»º Processor å®ä¾‹ï¼Œå¹¶ä¼ å…¥ Providers
const processor = new MDxProcessor([new AppProvider(), new FileProvider()]);

// 3. [å®šä¹‰è§„åˆ™] åˆ›å»ºä¸€ä¸ª ProcessOptions å¯¹è±¡ï¼Œå£°æ˜å¼åœ°å®šä¹‰è½¬æ¢è¡Œä¸º
const markdownText = `@app:parserai\nhere is the demo file:\n@file:file1`;
const options = {
    rules: {
        'app': {
            action: 'remove',       // ä»æ–‡æœ¬ä¸­ç§»é™¤ @app:parserai
            collectMetadata: true,  // å¹¶å°†å…¶ ID 'parserai' æ”¶é›†åˆ°å…ƒæ•°æ®ä¸­
        },
        'file': {
            action: 'replace',      // å°† @file:file1 æ›¿æ¢ä¸ºè‡ªå®šä¹‰å†…å®¹
            collectMetadata: true,  // åŒæ ·æ”¶é›†å…¶ ID
            // å®šä¹‰å¦‚ä½•ç”Ÿæˆæ›¿æ¢å†…å®¹
            getReplacementContent: (data, mention) => {
                if (!data) return `[File not found: ${mention.id}]`;
                return `---\n[filename: ${data.name}]\n---\n${data.content}\n---`;
            }
        }
    }
};

// 4. [æ‰§è¡Œ] è°ƒç”¨ process æ–¹æ³•
processor.process(markdownText, options).then(result => {
    console.log('--- Transformed Content ---');
    console.log(result.transformedContent);

    console.log('\n--- Extracted Metadata ---');
    console.log(result.metadata);

    /*
    --- Transformed Content ---
    here is the demo file:
    ---
    [filename: file1]
    ---
    hello world
    ---

    --- Extracted Metadata ---
    { app: [ 'parserai' ], file: [ 'file1' ] }
    */
});
```
`MDxProcessor` ä¸ºæ‚¨æä¾›äº†å°†ä¸€ç§æ ‡è®°è¯­è¨€è½¬æ¢ä¸ºå¦ä¸€ç§ç»“æ„åŒ–æ•°æ®å’Œæ–‡æœ¬çš„å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ã€‚

---

## ğŸ”Œ æ’ä»¶åŒ–æ¶æ„ï¼šæŒ‰éœ€å®šåˆ¶

MDxEditor çš„çœŸæ­£å¨åŠ›åœ¨äºå…¶æ’ä»¶ç³»ç»Ÿã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é…ç½®ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰ `@mention` åŠŸèƒ½çš„ç¼–è¾‘å™¨ã€‚

```javascript
// app.js
import { 
    MDxEditor, 
    MDxRenderer,
    MentionPlugin,
    IMentionProvider
} from 'mdx-editor-lib';

// 1. [æ‚¨çš„ä¸šåŠ¡é€»è¾‘] åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Provider æ¥æä¾›æ•°æ®
// Provider å®ç°äº† UI å’Œæ— å¤´å¤„ç†æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•
class FileMentionProvider extends IMentionProvider {
    key = 'file'; // å¿…é¡»çš„å”¯ä¸€æ ‡è¯†ç¬¦, å¯¹åº” mdx://file/...
    triggerChar = '@';

    async getSuggestions(query) {
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå‘èµ· API è¯·æ±‚æœç´¢æ–‡ä»¶
        const files = [
            { id: 'doc-123', name: 'Project Proposal.md' },
            { id: 'img-456', name: 'Company Logo.png' }
        ];
        return files
            .filter(f => f.name.toLowerCase().includes(query.toLowerCase()))
            .map(f => ({ id: f.id, label: `ğŸ“„ ${f.name}` })); // è¿”å›æŒ‡å®šæ ¼å¼
    }

    // (ç”¨äº MDxProcessor) æä¾›æ ¸å¿ƒæ•°æ®
    async getDataForProcess(targetURL) {
        const fileId = targetURL.pathname.substring(1);
        // ... æŸ¥æ‰¾æ–‡ä»¶å¹¶è¿”å›æ•°æ®å¯¹è±¡
        return { id: fileId, name: 'Proposal.md', content: '...' };
    }
}

// 2. å®ä¾‹åŒ– Mention æ’ä»¶
const mentionPlugin = new MentionPlugin({ providers: [new FileMentionProvider()] });

// 3. åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹ï¼Œå¹¶ä¼ å…¥æ’ä»¶
const editor = new MDxEditor(container, {
    renderer: new MDxRenderer([mentionPlugin]),
    plugins: [mentionPlugin],
    initialText: 'è¯·åœ¨è¿™é‡Œå¼•ç”¨æ–‡ä»¶ @'
});
```

## ğŸ“š æ ¸å¿ƒ API

### `MDxProcessor`

#### `new MDxProcessor(providers)`
åˆ›å»ºä¸€ä¸ªæ— å¤´å¤„ç†å™¨å®ä¾‹ã€‚
- `providers` (Array): ä¸€ä¸ª `IMentionProvider` å®ä¾‹çš„æ•°ç»„ã€‚

#### `processor.process(markdownText, options)`
å¤„ç† Markdown æ–‡æœ¬ã€‚
- `markdownText` (String): åŸå§‹ Markdown æ–‡æœ¬ã€‚
- `options` (ProcessOptions): å®šä¹‰è½¬æ¢è§„åˆ™çš„é…ç½®å¯¹è±¡ã€‚
- **è¿”å›**: `Promise<ProcessResult>`ï¼Œä¸€ä¸ªåŒ…å« `originalContent`, `transformedContent`, `mentions`, å’Œ `metadata` çš„å¯¹è±¡ã€‚

### `MDxRenderer`

#### `new MDxRenderer(plugins)`
åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨å®ä¾‹ã€‚
- `plugins` (Array): ä¸€ä¸ªæ’ä»¶å®ä¾‹çš„æ•°ç»„ã€‚

#### `renderer.render(element, markdown, options)`
æ¸²æŸ“ Markdownã€‚
- `element` (HTMLElement): æ¸²æŸ“ç»“æœçš„ç›®æ ‡å®¹å™¨ã€‚
- `markdown` (String): è¦æ¸²æŸ“çš„ Markdown æ–‡æœ¬ã€‚
- `options` (Object): æ¸²æŸ“é€‰é¡¹ï¼Œå¯ä»¥ä¼ é€’ç»™æ’ä»¶ã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶ Cloze çŠ¶æ€ï¼š
  ```javascript
  const options = {
      contextId: 'my-context',
      clozeStates: {
          'my-context_hash123': { isHidden: false, memoryTier: 'mature' }
      }
  };
  ```
### `MDxEditor` å’Œ `MDxRenderer` å®ä¾‹ API

`MDxEditor` å’Œ `MDxRenderer` å…±äº«ä¸€å¥—ç›¸ä¼¼çš„å…¬å…± API ç”¨äºå†…å®¹æ§åˆ¶å’Œäº¤äº’ã€‚

```javascript
const editor = new MDxEditor(container, options);
const renderer = new MDxRenderer(plugins);
```

#### `instance.search(query)`
æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹å¹¶é«˜äº®ã€‚
- `query` (String): è¦æœç´¢çš„æ–‡æœ¬ã€‚
- **è¿”å›**: `Array`ã€‚å¯¹äº `MDxEditor`ï¼Œè¿”å› `{ from, to }` ä½ç½®å¯¹è±¡æ•°ç»„ã€‚å¯¹äº `MDxRenderer`ï¼Œè¿”å›é«˜äº®çš„ `<mark>` DOM å…ƒç´ æ•°ç»„ã€‚

#### `instance.gotoMatch(match)`
è·³è½¬åˆ°æŒ‡å®šçš„åŒ¹é…é¡¹å¹¶é«˜äº®æ˜¾ç¤ºä¸ºâ€œå½“å‰é¡¹â€ã€‚
- `match`: ä¸€ä¸ªä» `search()` æ–¹æ³•è¿”å›çš„é¡¹ã€‚

#### `instance.clearSearch()`
æ¸…é™¤æ‰€æœ‰æœç´¢é«˜äº®ã€‚

*ç¤ºä¾‹ï¼šå®ç°ä¸€ä¸ªå¸¦â€œä¸‹ä¸€ä¸ªâ€åŠŸèƒ½çš„å¤–éƒ¨æœç´¢æ¡†*
```html
<input id="search-input" placeholder="æœç´¢...">
<button id="next-btn">ä¸‹ä¸€ä¸ª</button>
<span id="match-counter"></span>
```
```javascript
// `instance` å¯ä»¥æ˜¯ editor æˆ– renderer
const searchInput = document.getElementById('search-input');
const nextBtn = document.getElementById('next-btn');
const counter = document.getElementById('match-counter');

let matches = [];
let currentIndex = -1;

searchInput.addEventListener('input', (e) => {
    const query = e.target.value.trim();
    if (query) {
        matches = instance.search(query);
        currentIndex = -1;
        counter.textContent = `æ‰¾åˆ° ${matches.length} ä¸ªåŒ¹é…é¡¹`;
    } else {
        instance.clearSearch();
        matches = [];
        counter.textContent = '';
    }
});

nextBtn.addEventListener('click', () => {
    if (matches.length === 0) return;
    currentIndex = (currentIndex + 1) % matches.length;
    instance.gotoMatch(matches[currentIndex]);
    counter.textContent = `ç¬¬ ${currentIndex + 1} / ${matches.length} ä¸ª`;
});
```

#### `editor.switchTo(mode)`
åˆ‡æ¢ç¼–è¾‘å™¨çš„è§†å›¾ã€‚
- `mode` (String): `'edit'` æˆ– `'render'`ã€‚

#### `instance.getText()`
è·å–å½“å‰å®Œæ•´çš„ Markdown æ–‡æœ¬ã€‚
- **è¿”å›**: `String`

#### `instance.setText(markdownText)`
ç”¨æ–°çš„æ–‡æœ¬å†…å®¹æ›¿æ¢æ‰€æœ‰å†…å®¹ã€‚

#### `editor.setTitle(newTitle)`
**[æ–°åŠŸèƒ½]** åŠ¨æ€æ›´æ–°ç¼–è¾‘å™¨æ ‡é¢˜æ ä¸­æ˜¾ç¤ºçš„æ ‡é¢˜ã€‚è¿™åœ¨ä¸å¤–éƒ¨æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚æ–‡ä»¶æ ‘ï¼‰é›†æˆæ—¶éå¸¸æœ‰ç”¨ã€‚
- `newTitle` (String): è¦æ˜¾ç¤ºçš„æ–°æ ‡é¢˜ã€‚

*ç¤ºä¾‹ï¼šä¸æ–‡ä»¶åˆ—è¡¨é›†æˆ*
```javascript
// fileList æ˜¯ä½ çš„æ–‡ä»¶åˆ—è¡¨UIç»„ä»¶
fileList.on('fileSelected', (file) => {
    editor.setText(file.content);
    editor.setTitle(file.name); // æ›´æ–°æ ‡é¢˜ä»¥åŒ¹é…æ‰€é€‰æ–‡ä»¶
});
```

#### `editor.handleExternalUpdate({ uri, newLabel })`
**[å…³é”® API]** é€šçŸ¥ç¼–è¾‘å™¨å¤–éƒ¨å¼•ç”¨å·²æ›´æ–°ï¼Œå®ç°**å¼•ç”¨è‡ªåŠ¨æ›´æ–°**ã€‚
- `payload` (Object):
  - `uri` (String): è¢«æ›´æ–°é¡¹ç›®çš„å®Œæ•´ MDx URI, e.g., `'mdx://file/doc-123'`ã€‚
  - `newLabel` (String): æ–°çš„æ˜¾ç¤ºæ–‡æœ¬ã€‚

*ç¤ºä¾‹ï¼šå½“ç”¨æˆ·åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­é‡å‘½åæ–‡ä»¶æ—¶*
```javascript
// å‡è®¾ç”¨æˆ·åœ¨åˆ«å¤„å°† 'Project Proposal.md' é‡å‘½åä¸º 'Final Proposal.md'
// æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿç›‘å¬åˆ°äº†è¿™ä¸ªå˜åŒ–
const updatePayload = {
    uri: 'mdx://file/doc-123',
    newLabel: 'ğŸ“„ Final Proposal.md'
};
// é€šçŸ¥ç¼–è¾‘å™¨æ›´æ–°æ‰€æœ‰ç›¸å…³çš„ `[...](mdx://file/doc-123)` é“¾æ¥
editor.handleExternalUpdate(updatePayload);
```

#### `editor.destroy()`
é”€æ¯ç¼–è¾‘å™¨å®ä¾‹ï¼Œé‡Šæ”¾æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬ CodeMirror å®ä¾‹å’Œäº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

#### `editor.on(eventName, callback)`
**[æ–°åŠŸèƒ½]** ç›‘å¬ç¼–è¾‘å™¨çš„æ ¸å¿ƒäº‹ä»¶ï¼Œå¦‚å†…å®¹å˜æ›´ã€‚
- `eventName` (String): ç›®å‰æ”¯æŒ `'change'` äº‹ä»¶ã€‚
- `callback` (Function): äº‹ä»¶è§¦å‘æ—¶çš„å›è°ƒå‡½æ•°ã€‚
- **è¿”å›**: ä¸€ä¸ª `unsubscribe` å‡½æ•°ã€‚

*ç¤ºä¾‹ï¼šå®ç°è‡ªåŠ¨ä¿å­˜*
```javascript
let saveTimeout;
editor.on('change', () => {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        const content = editor.getText();
        // myApi.save(content);
        console.log('å†…å®¹å·²è‡ªåŠ¨ä¿å­˜ï¼');
    }, 500); // 500ms é˜²æŠ–
});
```

### æ’ä»¶é—´çš„äº¤äº’ï¼šæœåŠ¡ä¸äº‹ä»¶
æ’ä»¶å¯ä»¥é€šè¿‡**æœåŠ¡ (Services)** å’Œ**äº‹ä»¶ (Events)** è¿›è¡Œè§£è€¦é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äºæŠ½è®¤å¡çš„è‡ªå®šä¹‰æ’ä»¶å¯ä»¥ç›‘å¬ `clozeRevealed` äº‹ä»¶ï¼Œå¹¶åœ¨ç”¨æˆ·å›ç­”åï¼Œé€šè¿‡æ³¨å…¥çš„ `ClozeAPI` æœåŠ¡æ¥é‡æ–°éšè—å¡«ç©ºã€‚

```javascript
// anki-plugin.js
import { ClozeAPIKey } from 'mdx-editor-lib';

// ç›‘å¬ç”± ClozePlugin å‘å‡ºçš„å…¨å±€äº‹ä»¶
editor.pluginManager.listen('clozeRevealed', (detail) => {
    console.log(`å¡«ç©º "${detail.clozeId}" å·²è¢«æ­ç¤ºï¼`);
    
    // æ˜¾ç¤ºä¸€ä¸ªè¯„åˆ† UI...
    showFeedbackUI(detail.element, (userChoice) => {
        if (userChoice === 'again') {
            // é€šè¿‡æ³¨å…¥çš„ ClozeAPI æœåŠ¡æ¥å®‰å…¨åœ°æ“ä½œ DOM
            const clozeApiFactory = editor.getService(ClozeAPIKey);
            if (clozeApiFactory) {
                const clozeApi = clozeApiFactory(editor.renderEl);
                clozeApi.toggle(detail.clozeId, false); // é‡æ–°å…³é—­è¯¥å¡«ç©º
            }
        }
    });
});
```
è¿™ç§è®¾è®¡ä½¿å¾—å¤æ‚åŠŸèƒ½å¯ä»¥è¢«ä»»æ„ç»„åˆå’Œæ‰©å±•ï¼Œè€Œä¸ä¼šå¯¼è‡´ä»£ç æ··ä¹±ã€‚

## ğŸ› ï¸ å¼€å‘è‡ªå·±çš„æ’ä»¶

### 1. ç®€å•è¯­æ³•æ’ä»¶
åˆ›å»ºä¸€ä¸ªæ’ä»¶éå¸¸ç®€å•ï¼Œåªéœ€å®ç° `install` æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ·»åŠ  `||spoiler||` å‰§é€è¯­æ³•çš„æ’ä»¶ç¤ºä¾‹ï¼š

```javascript
// plugins/spoiler.plugin.js

// 1. å®šä¹‰ Marked.js è¯­æ³•æ‰©å±•
const spoilerExtension = {
    name: 'spoiler',
    level: 'inline',
    start: (src) => src.indexOf('||'),
    tokenizer(src) {
        const match = /^\|\|(.*?)\|\|/.exec(src);
        if (match) {
            return { type: 'spoiler', raw: match[0], text: match[1] };
        }
    },
    renderer(token) {
        // æ·»åŠ ç‚¹å‡»åˆ‡æ¢ class çš„ç®€å•äº¤äº’
        return `<span class="spoiler" onclick="this.classList.toggle('revealed')">${token.text}</span>`;
    }
};

// 2. åˆ›å»ºæ’ä»¶ç±»
export class SpoilerPlugin {
    name = 'custom:spoiler'; // å”¯ä¸€çš„æ’ä»¶åç§°

    install(context) {
        // 3. é€šè¿‡ä¸Šä¸‹æ–‡ API æ³¨å†Œä½ çš„åŠŸèƒ½
        context.registerSyntaxExtension(spoilerExtension);
    }
}
```

### 2. å®ç°é«˜çº§äº¤äº’ï¼šæä¾›è€…æ¨¡å¼ (Provider Pattern)
å¯¹äºåƒ `@mention` è¿™æ ·éœ€è¦ä¸å¤–éƒ¨æ•°æ®æºäº¤äº’çš„å¤æ‚åŠŸèƒ½ï¼ŒMDxEditor é‡‡ç”¨äº†**æä¾›è€…æ¨¡å¼**ã€‚æ‚¨åªéœ€å®ç° `IMentionProvider` æ¥å£ï¼Œå³å¯åŒæ—¶ä¸ºç¼–è¾‘å™¨UIå’Œæ— å¤´å¤„ç†å™¨æä¾›èƒ½åŠ›ã€‚

```javascript
// providers/jira-ticket.provider.js
import { IMentionProvider } from 'mdx-editor-lib';

export class JiraTicketProvider extends IMentionProvider {
    key = 'jira'; // å¯¹åº” mdx://jira/...
    triggerChar = '#'; // å¯ä»¥è‡ªå®šä¹‰è§¦å‘ç¬¦ï¼

    // æ ¹æ®ç”¨æˆ·è¾“å…¥è·å–å»ºè®®åˆ—è¡¨
    async getSuggestions(query) {
        const response = await fetch(`/api/jira/search?q=${query}`);
        const tickets = await response.json();
        return tickets.map(t => ({ id: t.key, label: `${t.key}: ${t.summary}` }));
    }

    // [å¯é€‰] å®šä¹‰ç‚¹å‡»é“¾æ¥æ—¶çš„è¡Œä¸º
    async handleClick(targetURL) {
        const ticketId = targetURL.pathname.substring(1);
        window.open(`https://my-jira.com/browse/${ticketId}`);
    }

    // [å¯é€‰] æä¾›æ‚¬æµ®é¢„è§ˆçš„å†…å®¹
    async getHoverPreview(targetURL) {
        const ticketId = targetURL.pathname.substring(1);
        const response = await fetch(`/api/jira/ticket/${ticketId}`);
        const ticket = await response.json();
        return {
            title: `${ticket.key}: ${ticket.summary}`,
            contentHTML: `<p>Status: <strong>${ticket.status}</strong></p><p>Assignee: ${ticket.assignee.name}</p>`
        };
    }
}
```
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥å°†ä»»ä½•æ•°æ®æºæ— ç¼é›†æˆåˆ° MDxEditor çš„æåŠã€é“¾æ¥å’ŒåµŒå…¥ç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶æœåŠ¡äºå‰ç«¯äº¤äº’å’Œåç«¯å¤„ç†ä¸¤ç§åœºæ™¯ã€‚

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬ Bug æŠ¥å‘Šã€åŠŸèƒ½è¯·æ±‚æˆ–ä»£ç æäº¤ã€‚è¯·åœ¨å¼€å§‹å·¥ä½œå‰æŸ¥é˜…æˆ‘ä»¬çš„è´¡çŒ®æŒ‡å—ï¼ˆå¾…è¡¥å……ï¼‰ï¼Œå¹¶åœ¨ GitHub ä¸Šåˆ›å»º Issue æˆ– Pull Requestã€‚

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](./LICENSE)ã€‚