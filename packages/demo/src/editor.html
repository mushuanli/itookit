<!-- #demo/editor.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MDxEditor 全功能演示</title>

    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f2f5; max-width: 900px; margin: auto; }
        h1, h2 { color: #333; }
        .demo-section { background-color: white; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 2em; padding: 1em 1.5em; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .demo-controls { padding: 10px 0; border-bottom: 1px solid #eee; margin-bottom: 1em; }
        .demo-output { min-height: 100px; }
        textarea { width: 100%; min-height: 150px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; padding: 8px; font-family: monospace; }
        pre { background-color: #f8f9fa; padding: 1em; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
        
        /* --- FIX STARTS HERE --- */
        /* 将全局 button 选择器改为更具体的 .demo-controls button，避免影响编辑器工具栏 */
        .demo-controls button { 
            padding: 8px 15px; 
            border-radius: 4px; 
            border: 1px solid #007bff; 
            background-color: #007bff; 
            color: white; 
            cursor: pointer; 
            margin-top: 5px;
            margin-right: 5px;
        }
        .demo-controls button:hover { 
            background-color: #0056b3; 
        }
        .demo-controls button:disabled { 
            background-color: #ccc; 
            border-color: #ccc; 
            cursor: not-allowed; 
        }
        /* --- FIX ENDS HERE --- */

        /* [新增] CodeMirror 6 独立演示的样式 */
        .cm-editor {
            border: 1px solid #ccc;
            height: 300px; /* 调整高度以适应页面 */
        }
        
        /* [新增] Processor Demo 样式 */
        .processor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
        }
        .processor-grid h3 { margin-top: 0; }
        
        /* [NEW] 全局搜索UI样式 */
        #global-search-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #global-search-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #search-results-count {
            font-size: 0.9em;
            color: #555;
            min-width: 80px; /* 避免文字跳动 */
        }
    </style>
</head>
<body>

    <h1>MDxEditor 全功能演示</h1>

    <!-- [NEW] 场景0: 全局搜索功能 -->
    <div class="demo-section">
        <h2>0. 全局搜索 API 演示</h2>
        <p>在此输入文本，可实时搜索下方所有编辑器和渲染器中的内容。这展示了为 <code>MDxEditor</code> 和 <code>MDxRenderer</code> 实现的统一搜索接口。</p>
        <div id="global-search-bar" class="demo-controls">
            <input type="text" id="global-search-input" placeholder="在所有示例中搜索...">
            <button id="search-prev-btn" disabled>&lt; 上一个</button>
            <button id="search-next-btn" disabled>下一个 &gt;</button>
            <span id="search-results-count"></span>
        </div>
    </div>

    <!-- 场景1: MDxEditor 编辑器 -->
    <div class="demo-section" id="search-target-1">
        <h2>1. MDxEditor - 集成编辑器</h2>
        <p>在此处编写 Markdown，点击工具栏 "Preview" 查看渲染效果。在预览模式下，按住 <b>Ctrl/Cmd + 双击</b> 可跳回源码。</p>
        <div class="demo-controls">
            <strong>外部控制 API & 事件监听:</strong>
            <button id="external-edit-btn">切换到编辑视图</button>
            <button id="external-preview-btn">切换到预览视图</button>
            <span id="current-mode-display" style="margin-left: 20px; font-style: italic;"></span>
        </div>

        <div id="app-container" style="height: 500px; margin-top: 1em;"></div>
    </div>

    <!-- 场景2: Mention 系统演示 -->
    <div class="demo-section" id="search-target-2">
        <h2>2. Mention 系统 - 高级链接与嵌入</h2>
        <p>
            这是一个集成了自定义 <b>@mention</b> 系统的编辑器。尝试输入 <code>@</code> 并查看建议。
            将鼠标悬停在链接上可查看预览，点击链接将触发警报。
            使用 <code>!@file:doc-2</code> 语法可动态嵌入其他文档的内容。
        </p>
        <div class="demo-controls">
            <strong>外部服务调用模拟:</strong>
            <button id="rename-doc1-btn">将 "Project Proposal" 重命名为 "Final Proposal"</button>
        </div>
        <div id="mention-editor-container" style="height: 600px; margin-top: 1em;"></div>
    </div>

    <!-- 场景3: Anki 静态渲染 -->
    <div class="demo-section" id="search-target-3">
        <h2>3. MDxRenderer - 高级静态渲染 (Anki 场景)</h2>
        <div class="demo-controls">
            <textarea id="anki-input" style="min-height: 200px;"></textarea>
            <button id="render-anki">渲染</button>
        </div>
        <p><b>交互说明：</b>点击 Cloze 会显示反馈按钮。点击 Cloze 中的音量图标会朗读单词。勾选任务会触发事件。</p>
        <div id="anki-output" class="demo-output rich-content-area"></div>
    </div>

    <!-- 场景4: Agent 流式渲染 -->
    <div class="demo-section">
        <h2>4. MDxRenderer - AI 助手流式渲染</h2>
        <div class="demo-controls">
            <button id="render-stream">开始流式渲染</button>
        </div>
        <div id="agent-output" class="demo-output rich-content-area"></div>
    </div>
    
    <!-- 场景 5: MDxProcessor 无头处理演示 -->
    <div class="demo-section">
        <h2>5. MDxProcessor - 无头（Headless）处理引擎</h2>
        <p>
            这个演示展示了 `MDxProcessor` 如何在没有任何UI编辑器的情况下，独立地对Markdown文本进行解析和转换。
            你可以修改下面的处理规则（JSON格式），然后点击 "Process" 按钮查看不同的输出结果。
        </p>
        <div class="processor-grid">
            <div>
                <h3>输入 Markdown</h3>
                <textarea id="processor-input"></textarea>
            </div>
            <div>
                <h3>处理规则 (ProcessOptions)</h3>
                <textarea id="processor-options" style="font-family: monospace;"></textarea>
            </div>
        </div>
        <div class="demo-controls">
            <button id="process-btn">Process</button>
        </div>
        <h3>处理结果 (ProcessResult)</h3>
        <pre id="processor-output">点击 "Process" 按钮查看结果...</pre>
    </div>

    <!-- Demo 逻辑脚本 -->
    <script type="module" src="editor.js"></script>

</body>
</html>